<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  
  <style>
	model-viewer {
		position:absolute;
		border: 0;
		border-radius: 0%;
		height:50%;
		width:100%;
		margin: 0 auto;
    top: 50%;
    left: 50%;
    transform: translate(-50%,-50%);
	}
		
	
	</style>
  </head>

  <body>
	<audio id="background-music" autoplay loop>
		<source src="bgm.mp3" type="audio/mp3">
		Your browser does not support the audio element.
	</audio>
	  <model-viewer id="gameboy" src="ball.glb"
			ios-src="../Model_Gameboy.usdz"
			alt="A 3D model of an astronaut"
			ar
			auto-rotate
	    	camera-controls></model-viewer>
      <button id="backButton">返回</button>
  </body>


  <script>
    // 获取返回按钮
    const modelViewer = document.querySelector('model-viewer');
    let ar=false;
    
    
    function isMobileDeviceAR() {
      const userAgent = navigator.userAgent.toLowerCase();
      return /iphone|ipod|android|windows phone|blackberry|iemobile/.test(userAgent);
    }

    function triggerAR() {
      

          //arButton.click();  // 模擬點擊 AR 按鈕
          //modelViewer.activateAR();
    }

    if(isMobileDeviceAR()){
      if (modelViewer) {
        modelViewer.addEventListener('load', function() {
            console.log('Model-viewer has fully loaded.');
            // 等待 shadowRoot 生成，並觸發 AR 按鈕
            //backButton.click();
            setTimeout(() => {
              
            },1000);
            
        });
    }
    }
    const backButton = document.getElementById("backButton");

    // 为返回按钮添加点击事件
    backButton.addEventListener("click", function() {
      window.close();
    });
    document.addEventListener("click", function() {
      // 尝试关闭当前页面
      if(!ar){
        modelViewer.activateAR();
        ar=true;
      }
    });
    modelViewer.addEventListener("click", function() {
      // 尝试关闭当前页面
      if(!ar){
        modelViewer.activateAR();
        ar=true;
      }
    });
    const music = document.getElementById('background-music');

    modelViewer.addEventListener('ar-status', (event) => {
      if (event.detail.status === 'session-started') {
        // 當 AR 模式開始時，播放音樂
        music.play();
      } else if (event.detail.status === 'session-ended') {
        // 當 AR 模式結束時，暫停音樂
        music.pause();
      }
    });
  </script>
</html>